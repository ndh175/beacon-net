L.TileLayer.Zoomify=L.TileLayer.extend({options:{continuousWorld:!0,tolerance:.8},initialize:function(i,t){t=L.setOptions(this,t),this._url=i;var e=L.point(t.width,t.height),o=t.tileSize;for(this._imageSize=[e],this._gridSize=[this._getGridSize(e)];parseInt(e.x)>o||parseInt(e.y)>o;)e=e.divideBy(2).floor(),this._imageSize.push(e),this._gridSize.push(this._getGridSize(e));this._imageSize.reverse(),this._gridSize.reverse(),this.options.maxZoom=this._gridSize.length-1},onAdd:function(i){L.TileLayer.prototype.onAdd.call(this,i);var t=i.getSize(),e=this._getBestFitZoom(t),o=this._imageSize[e],r=i.options.crs.pointToLatLng(L.point(o.x/2,o.y/2),e);i.setView(r,e,!0)},_getGridSize:function(i){var t=this.options.tileSize;return L.point(Math.ceil(i.x/t),Math.ceil(i.y/t))},_getBestFitZoom:function(i){for(var t,e=this.options.tolerance,o=this._imageSize.length-1;o;){if((t=this._imageSize[o]).x*e<i.x&&t.y*e<i.y)return o;o--}return o},_tileShouldBeLoaded:function(i){var t=this._gridSize[this._map.getZoom()];return i.x>=0&&i.x<t.x&&i.y>=0&&i.y<t.y},_addTile:function(i,t){var e=this._getTilePos(i),o=this._getTile(),r=this._map.getZoom(),s=this._imageSize[r],n=this._gridSize[r],h=this.options.tileSize;i.x===n.x-1&&(o.style.width=s.x-h*(n.x-1)+"px"),i.y===n.y-1&&(o.style.height=s.y-h*(n.y-1)+"px"),L.DomUtil.setPosition(o,e,L.Browser.chrome||L.Browser.android23),this._tiles[i.x+":"+i.y]=o,this._loadTile(o,i),o.parentNode!==this._tileContainer&&t.appendChild(o)},getTileUrl:function(i){return this._url+"TileGroup"+this._getTileGroup(i)+"/"+this._map.getZoom()+"-"+i.x+"-"+i.y+".jpg"},_getTileGroup:function(i){var t,e=this._map.getZoom(),o=0;for(z=0;z<e;z++)o+=(t=this._gridSize[z]).x*t.y;return o+=i.y*this._gridSize[e].x+i.x,Math.floor(o/256)}}),L.tileLayer.zoomify=function(i,t){return new L.TileLayer.Zoomify(i,t)};